---
title: Windows10 中 thunderbolt3 接口的故障排查经历
category: 随笔
published: 2021-03-04 22:22:37
tags:
  - thunderbolt
---

主板型号是 `z490 GodLike`, 微星旗下 `Z490` 系列最高端的品牌，拓展坞是贝尔金的 Intel 认证的 13 合一的那一款。
拓展坞插到电脑上的时候毫无反应，想了一下可能是缺少驱动。于是就上微星官网找了一下，果然有一个 thunderbolt 的驱动，下载下来却发现根本不知道如何安装：
![](/imgs/a-thunderbolt3-question-on-windows/thunderbolt-1.png)
看起来执行 setup 这个批处理文件就好了，但是每次执行都是失败，毫无进展。

于是直接上网搜 thunderbolt 的驱动，看到 intel 官方有给自己 NCU 产品提供的[驱动](https://www.intel.cn/content/www/cn/zh/search.html?ws=text#q=thunderbolt&t=Downloads&layout=**table**)，于是下载下来直接安装。安装好后会有一个 Thunderbolt 控制中心的应用，同时在设备管理器里面也能看到名为 `Thunderbolt(TM) Controller - xxxx`的设备：
![](/imgs/a-thunderbolt3-question-on-windows/thunderbolt-device.png)
同时打开前面提到安装好的 Thunderbolt 控制中心，能看到如下展示就说明驱动都没有问题了：
![](/imgs/a-thunderbolt3-question-on-windows/thunderbolt-details.png)

重新插拔拓展坞，会看到控制中心有提示新的设备接入，需要授权（如果 Bios 中设置的不需要授权就不会有这个提示）：
![](/imgs/a-thunderbolt3-question-on-windows/thunderbolt-app.png)
点击授权就好了。
至此，第一次 ThunderBolt3 拓展坞的连接就成功了，安装在上面的 U 盘之类的扩展设备也都能正常的识别和读取。

## 奇怪的事情

按理说我的拓展坞已经正常运行了，不应该再有其他的事情了。上面的操作也都是常规操作不值得专门写一篇文章记录，然而奇怪的事情就在几天后发生了。

<!-- more -->

我照常插上 U 盘，发现不识别，仔细看了一下拓展坞的指示灯也变成不正常的黄色了。但是我这几天明明什么都没有做，也没有更新过系统，也没有安装过奇怪的东西，怎么突然就不行了呢？我做了以下尝试：

- 重新插拔拓展坞：无效
- 卸载并重装驱动：无效

我就怀疑这个拓展坞坏了，然后上京东申请了售后,心里还在想这两千块大洋的东西怎么质量这么差呢。京东的小哥倒是很快就上门把东西拿走了。

刚好我有个 type-c 接口的移动硬盘要用，想着雷电 3 接口是向下兼容 type-c 的，就插到了那个雷电 3 接口里面。如你所想，毫无反应，我又换上了我的手机插上，毫无反应，电都不冲。这回我就有点懵了，电都不冲，难道是硬件坏了？为了避免是微星的接口做了阉割，我还专门上官网查了我这块主板的雷电 3 接口介绍：
![](/imgs/a-thunderbolt3-question-on-windows/thunderbolt-msi-3.png)
写的很清楚，向下兼容 usb 3.2 而且支持 5V/3A 的充电，所以难道真的是我的主板里面接口坏掉了吗。怀着难受的心，我先是咨询了微星客服，向客服描述了我的主机现状：

- 不充电
- 插 USB 协议的硬盘也不识别

客服觉得按照我的描述应该是主板硬件坏了，建议我走售后流程，并告知我如何报修后我们就挂断了电话。我一想，走售后的话太麻烦了，要先把主机拆掉，然后把主板寄到售后地址，等检查修完再寄回来，太麻烦了，太麻烦了。我结合之前的情况判断了一下，硬件应该是没有问题的，于是又开始了排查问题之旅。
周六那一天早上起来我就开始排查问题，做各种尝试：

- 重刷主板 BIOS
- 再 BIOS 中关闭 Thunderbolt 开关并重新开启
- 卸载并重装驱动

期间重启了 N 此电脑，最终都以失败告终。就剩下一个没做了，那就是重装系统。但重装系统对我来说代价太大了，我又要花很多时间来配置各种开发环境，安装各种软件，想想都麻烦。于是再几个论坛发了帖子，一段时间后也没有有意义的回复，只能靠自己了。

既然我觉得重装系统有可能解决问题，那么就需要进一步排除 Windows 操作系统带来的干扰。于是开机直接进 BIOS ，然后把我的 Switch 插上去，第一次没有反应，我就拔了再插了一次，竟然充电了！直接开机插的时候都是不充的，现在竟然充了。那么就说明我的硬件是没有问题的，别提我有多高兴了。

于是插着 Switch 开机，进入系统后依然保持充电状态了。我试着拔掉重插了一下，又不冲了，什么情况？！我就继续插拔，发现大约插拔七八次，会有一次成功充电。而且从设备管理器中可以看到，thunderbolt3 的驱动一直在掉了又自动安装上，就这样在有驱动和没驱动之间反复横跳。

至此，我已经大概率怀疑是系统的问题了。不说了，重装吧！直接用 Windows10 提供的恢复系统功能，选择保留个人文件重刷系统的选项进行重装。重装好后自带雷电 3 驱动，兴奋的插上我的移动硬盘， 这次应该好了吧。然后残酷的现实再一次给我破了冷水，毫无反应。一怒之下，我再次选择恢复系统，并选择其中的不保留个人文件。这相当于真正的重装系统，我也已经做好了花大量时间来重新配置系统的准备。这次重装之后，再插上我的移动硬盘。噢，自动弹出了资源管理器并打开了这个移动硬盘。我知道，好了，都好了。我花差不多四千五百块大洋买的主板还是没有问题的，问题都是这个奇怪的 Windows 操作系统。

后来京东换货的拓展坞也到了，插上也是一切正常，问题已经解决了。

## 总结

对于第二次为什么接口出问题了，到现在我也不清楚，按理说重装过驱动没有解决问题就应该排除掉是系统的问题，但最后还是通过重装解决了，神奇。
总结一下雷电 3 接口能正常运转的必要条件：

1. BIOS 中打开 Thunderbolt 相关开关
2. 安装 Intel 提供的 Thunderbolt 驱动和控制中心程序
3. 上一步完成后，设备管理器中应该可以看到系统设备中有了 `Thunderbolt(TM) Controller - xxxx` 的设备
4. 插上雷电 3 设备后，需要在第 2 步提到的控制中心程序中允许连接

以上四部都做完如果接口还是不能正常运转的话，可以做以下尝试：

- 重刷主板 BIOS
- 重装系统

理论上这样就能解决所有可能是软件造成的问题了，如果到这一步还是不行，那就只能找硬件问题了。
只能说，祝好运。
